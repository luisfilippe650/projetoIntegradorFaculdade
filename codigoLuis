#include <math.h>

//sensor de fogo
int vetorFrente[3]; 
int vetorEsquerdo[3]; 
int vetorDireito[3]; 

int sensorFrente = A1;
int sensorEsquerdo = A2;
int sensorDireito = A0;

int resultadoSensorFrente;
int resultadoSensorEsquerdo;
int resultadoSensorDireito;
int visualizar;

int patrulha = 0;

//motor lado direito
const int enA = 10;
const int in1 = 9;
const int in2 = 8;
//motor lado esquerdo
const int enB = 4;
const int in3 = 6;
const int in4 = 5;

int velocidade = 200;

void setup() {
  Serial.begin(9600);

  //sensor
  pinMode(sensorFrente, INPUT);
  pinMode(sensorEsquerdo, INPUT);
  pinMode(sensorDireito, INPUT);

  // motor rodas
  pinMode(enA, OUTPUT);
  pinMode(enB, OUTPUT);
  pinMode(in1, OUTPUT);
  pinMode(in2, OUTPUT);
  pinMode(in3, OUTPUT);
  pinMode(in4, OUTPUT);

  analogWrite(enA, velocidade);
  analogWrite(enB, velocidade);

  parar(); // começa parado
}

//Loop principal
void loop() {
  visualizar = analogRead(sensorFrente);
  // faz 3 leituras do sensor
  for (int i = 0; i < 3; i++) { 
    vetorFrente[i] = analogRead(sensorFrente);
  }
   for (int i = 0; i < 3; i++) { 
    vetorEsquerdo[i] = analogRead(sensorEsquerdo);
  }
   for (int i = 0; i < 3; i++) { 
    vetorDireito[i] = analogRead(sensorDireito);
  }
 

  // calcula a média das leituras
  resultadoSensorFrente = media( vetorFrente[0],  vetorFrente[1],  vetorFrente[2]);
  resultadoSensorEsquerdo = media(vetorEsquerdo[0], vetorEsquerdo[1], vetorEsquerdo[2]);
  resultadoSensorDireito = media(vetorDireito[0], vetorDireito[1], vetorDireito[2]);

  // analisa o resultado
   if (resultadoSensorFrente <= 210) {
    Serial.println("fogo bem perto...");
    Serial.println(visualizar);
      parar();

    }

  else if (resultadoSensorFrente >= 210 && resultadoSensorFrente <= 800) {
      Serial.println("fogo longe...");
      Serial.println(visualizar);
      mov_fnt();
  }

  else if ( resultadoSensorEsquerdo < 700){
    //carrinho ira virar
    Serial.println("virando para esquerda");
    manobraEsquerda();
  }

  else if (resultadoSensorDireito < 700){
    Serial.println("virando para direita");
    manobraDireita();
  }

  else if(patrulha == 10 ){
    mov_patrulha();
    patrulha = 0; 
  }
  else{
    Serial.println("nenhum fogo detectado");
    patrulha++;
  }
  
  delay(2500);
}

// função para calcular média
int media(int a, int b, int c) {
  int resultado = (a + b + c) / 3;
  return resultado;
}

//Movimentos
void mov_fnt(){
  digitalWrite(in1, HIGH);
  digitalWrite(in2, LOW);
  digitalWrite(in3, LOW);
  digitalWrite(in4, HIGH);
  delay(1000);
}
void mov_tras(){
  digitalWrite(in1, LOW);
  digitalWrite(in2, HIGH);
  digitalWrite(in3, HIGH);
  digitalWrite(in4, LOW);
  delay(1000);
}
void mov_dir(){
  digitalWrite(in1, LOW);
  digitalWrite(in2, HIGH);
  digitalWrite(in3, LOW);
  digitalWrite(in4, HIGH);
  delay(1000);
}
void mov_esq(){
  digitalWrite(in1, HIGH);
  digitalWrite(in2, LOW);
  digitalWrite(in3, HIGH);
  digitalWrite(in4, LOW);
  delay(1000);
}
void parar(){
  digitalWrite(in1, LOW);
  digitalWrite(in2, LOW);
  digitalWrite(in3, LOW);
  digitalWrite(in4, LOW);
  delay(1000);
}

void manobraDireita() {
  // anda pra trás um pouquinho
  mov_tras();

  // para rapidamente
  parar();

  // vira pra direita
  mov_dir();

  // e volta a seguir em frente
  mov_fnt();

  parar();
}

void manobraEsquerda() {
  // anda pra trás um pouquinho
  mov_tras();
  delay(1000);

  // para rapidamente
  parar();
  delay(300);

  // vira pra esquerda
  mov_esq();
  delay(800);

  // e volta a seguir em frente
  mov_fnt();
  delay(1500);

  parar();
}

void mov_patrulha(){
  Serial.println("carrinho entrando no modo patrulha....");

  int vel = random(0,5);

  switch(vel){
    case 1: {
      mov_fnt();
      break;
    }
    case 2: {
      mov_tras();

      break;
    }
    case 3:{
      mov_dir();
      break;
    }
    case 4: {
      mov_esq();
      break;
    }
    case 5: {
      //virando 360
      mov_dir();
      mov_dir();
      break;
    }
  }
}

